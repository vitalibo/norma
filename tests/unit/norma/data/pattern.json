[
  {
    "description": "null matches '^[a-z]*$'",
    "engines": [
      "pandas",
      "pyspark"
    ],
    "given": {
      "data": [
        {
          "col": null
        }
      ],
      "schema": {
        "pandas": {
          "col": "string[python]"
        },
        "pyspark": {
          "type": "struct",
          "fields": [
            {
              "name": "col",
              "type": "void"
            }
          ]
        }
      }
    },
    "when": {
      "json_schema": {
        "type": "object",
        "properties": {
          "col": {
            "type": "string",
            "pattern": "^[a-z]*$"
          }
        }
      }
    },
    "then": {
      "data": [
        {
          "col": null,
          "errors": {}
        }
      ],
      "schema": {
        "pyspark": {
          "type": "struct",
          "fields": [
            {
              "name": "col",
              "type": "string"
            },
            {
              "name": "errors",
              "type": {
                "type": "map",
                "keyType": "string",
                "valueContainsNull": true,
                "valueType": {
                  "type": "struct",
                  "fields": [
                    {
                      "name": "details",
                      "type": {
                        "type": "array",
                        "containsNull": true,
                        "elementType": {
                          "type": "struct",
                          "fields": [
                            {
                              "name": "type",
                              "type": "string"
                            },
                            {
                              "name": "msg",
                              "type": "string"
                            }
                          ]
                        }
                      },
                      "nullable": false
                    },
                    {
                      "name": "original",
                      "type": "string"
                    }
                  ]
                }
              },
              "nullable": false
            }
          ]
        }
      }
    }
  },
  {
    "description": "'abc' matches '^[a-z]*$'",
    "engines": [
      "pandas",
      "pyspark"
    ],
    "given": {
      "data": [
        {
          "col": "abc"
        }
      ],
      "schema": {
        "pyspark": {
          "type": "struct",
          "fields": [
            {
              "name": "col",
              "type": "string"
            }
          ]
        }
      }
    },
    "when": {
      "json_schema": {
        "type": "object",
        "properties": {
          "col": {
            "type": "string",
            "pattern": "^[a-z]*$"
          }
        }
      }
    },
    "then": {
      "data": [
        {
          "col": "abc",
          "errors": {}
        }
      ],
      "schema": {
        "pyspark": {
          "type": "struct",
          "fields": [
            {
              "name": "col",
              "type": "string"
            },
            {
              "name": "errors",
              "type": {
                "type": "map",
                "keyType": "string",
                "valueContainsNull": true,
                "valueType": {
                  "type": "struct",
                  "fields": [
                    {
                      "name": "details",
                      "type": {
                        "type": "array",
                        "containsNull": true,
                        "elementType": {
                          "type": "struct",
                          "fields": [
                            {
                              "name": "type",
                              "type": "string"
                            },
                            {
                              "name": "msg",
                              "type": "string"
                            }
                          ]
                        }
                      },
                      "nullable": false
                    },
                    {
                      "name": "original",
                      "type": "string"
                    }
                  ]
                }
              },
              "nullable": false
            }
          ]
        }
      }
    }
  },
  {
    "description": "'abc1' matches '^[a-z]*$', error is raised",
    "engines": [
      "pandas",
      "pyspark"
    ],
    "given": {
      "data": [
        {
          "col": "abc1"
        }
      ],
      "schema": {
        "pyspark": {
          "type": "struct",
          "fields": [
            {
              "name": "col",
              "type": "string"
            }
          ]
        }
      }
    },
    "when": {
      "json_schema": {
        "type": "object",
        "properties": {
          "col": {
            "type": "string",
            "pattern": "^[a-z]*$"
          }
        }
      }
    },
    "then": {
      "data": [
        {
          "col": null,
          "errors": {
            "col": {
              "details": [
                {
                  "type": "string_pattern_mismatch",
                  "msg": "String should match pattern \"^[a-z]*$\""
                }
              ],
              "original": "\"abc1\""
            }
          }
        }
      ],
      "schema": {
        "pyspark": {
          "type": "struct",
          "fields": [
            {
              "name": "col",
              "type": "string"
            },
            {
              "name": "errors",
              "type": {
                "type": "map",
                "keyType": "string",
                "valueContainsNull": true,
                "valueType": {
                  "type": "struct",
                  "fields": [
                    {
                      "name": "details",
                      "type": {
                        "type": "array",
                        "containsNull": true,
                        "elementType": {
                          "type": "struct",
                          "fields": [
                            {
                              "name": "type",
                              "type": "string"
                            },
                            {
                              "name": "msg",
                              "type": "string"
                            }
                          ]
                        }
                      },
                      "nullable": false
                    },
                    {
                      "name": "original",
                      "type": "string"
                    }
                  ]
                }
              },
              "nullable": false
            }
          ]
        }
      }
    }
  },
  {
    "description": "'abc' matches '^[a-z*$', exception is raised",
    "engines": [
      "pandas",
      "pyspark"
    ],
    "given": {
      "data": [
        {
          "col": "abc"
        }
      ],
      "schema": {
        "pyspark": {
          "type": "struct",
          "fields": [
            {
              "name": "col",
              "type": "string"
            }
          ]
        }
      }
    },
    "when": {
      "json_schema": {
        "type": "object",
        "properties": {
          "col": {
            "type": "string",
            "pattern": "^[a-z*$"
          }
        }
      }
    },
    "then": {
      "raises": {
        "type": "ValueError",
        "match": "pattern must be a valid regular expression"
      }
    }
  },
  {
    "description": "123 matches '^[a-z]*$', exception is raised",
    "engines": [
      "pandas",
      "pyspark"
    ],
    "given": {
      "data": [
        {
          "col": 123
        }
      ],
      "schema": {
        "pyspark": {
          "type": "struct",
          "fields": [
            {
              "name": "col",
              "type": "integer"
            }
          ]
        }
      }
    },
    "when": {
      "json_schema": {
        "type": "object",
        "properties": {
          "col": {
            "type": "integer",
            "pattern": "^[a-z]*$"
          }
        }
      }
    },
    "then": {
      "raises": {
        "type": "ValueError",
        "match": "pattern rule can only be applied to string columns"
      }
    }
  },
  {
    "description": "cast(123 as str) matches '^[a-z]*$', error is raised",
    "engines": [
      "pandas",
      "pyspark"
    ],
    "given": {
      "data": [
        {
          "col": 123
        }
      ],
      "schema": {
        "pyspark": {
          "type": "struct",
          "fields": [
            {
              "name": "col",
              "type": "integer"
            }
          ]
        }
      }
    },
    "when": {
      "json_schema": {
        "type": "object",
        "properties": {
          "col": {
            "type": "string",
            "pattern": "^[a-z]*$"
          }
        }
      }
    },
    "then": {
      "data": [
        {
          "col": null,
          "errors": {
            "col": {
              "details": [
                {
                  "type": "string_pattern_mismatch",
                  "msg": "String should match pattern \"^[a-z]*$\""
                }
              ],
              "original": "123"
            }
          }
        }
      ],
      "schema": {
        "pyspark": {
          "type": "struct",
          "fields": [
            {
              "name": "col",
              "type": "string"
            },
            {
              "name": "errors",
              "type": {
                "type": "map",
                "keyType": "string",
                "valueContainsNull": true,
                "valueType": {
                  "type": "struct",
                  "fields": [
                    {
                      "name": "details",
                      "type": {
                        "type": "array",
                        "containsNull": true,
                        "elementType": {
                          "type": "struct",
                          "fields": [
                            {
                              "name": "type",
                              "type": "string"
                            },
                            {
                              "name": "msg",
                              "type": "string"
                            }
                          ]
                        }
                      },
                      "nullable": false
                    },
                    {
                      "name": "original",
                      "type": "string"
                    }
                  ]
                }
              },
              "nullable": false
            }
          ]
        }
      }
    }
  },
  {
    "description": "'abc' matches null, exception is raised",
    "engines": [
      "pandas",
      "pyspark"
    ],
    "given": {
      "data": [
        {
          "col": "abc"
        }
      ],
      "schema": {
        "pyspark": {
          "type": "struct",
          "fields": [
            {
              "name": "col",
              "type": "string"
            }
          ]
        }
      }
    },
    "when": {
      "schema": {
        "columns": {
          "col": {
            "dtype": "str",
            "rules": {
              "expr": "rules.pattern(None)"
            }
          }
        }
      }
    },
    "then": {
      "raises": {
        "type": "ValueError",
        "match": "pattern must be a string"
      }
    }
  },
  {
    "description": "'abc' matches '[a-z]+'",
    "engines": [
      "pandas_api"
    ],
    "given": {
      "data": [
        {
          "col": "abc"
        }
      ],
      "dtype": "string[python]"
    },
    "when": {
      "args": {
        "regex": "[a-z]+"
      }
    },
    "then": {
      "data": [
        "abc"
      ],
      "dtype": "string[python]",
      "masks": {
        "col": [
          false
        ]
      },
      "errors": {}
    }
  },
  {
    "description": "'abc' matches '[0-9]+', error is raised",
    "engines": [
      "pandas_api"
    ],
    "given": {
      "data": [
        {
          "col": "ab"
        }
      ],
      "dtype": "string[python]"
    },
    "when": {
      "args": {
        "regex": "[0-9]+"
      }
    },
    "then": {
      "data": [
        "ab"
      ],
      "dtype": "string[python]",
      "masks": {
        "col": [
          true
        ]
      },
      "errors": {
        "0": {
          "col": {
            "details": [
              {
                "type": "string_pattern_mismatch",
                "msg": "String should match pattern \"[0-9]+\""
              }
            ]
          }
        }
      }
    }
  },
  {
    "description": "$.col1.col2=null matches '^[a-z]*$'",
    "engines": [
      "pyspark"
    ],
    "given": {
      "data": [
        {
          "col1": {
            "col2": null
          }
        }
      ],
      "schema": {
        "pyspark": {
          "fields": [
            {
              "name": "col1",
              "type": {
                "type": "struct",
                "fields": [
                  {
                    "name": "col2",
                    "type": "string"
                  }
                ]
              }
            }
          ]
        }
      }
    },
    "when": {
      "json_schema": {
        "type": "object",
        "properties": {
          "col1": {
            "type": "object",
            "properties": {
              "col2": {
                "type": "string",
                "pattern": "^[a-z]*$"
              }
            }
          }
        }
      }
    },
    "then": {
      "data": [
        {
          "col1": {
            "col2": null
          },
          "errors": {}
        }
      ],
      "schema": {
        "pyspark": {
          "type": "struct",
          "fields": [
            {
              "name": "col1",
              "type": {
                "type": "struct",
                "fields": [
                  {
                    "name": "col2",
                    "type": "string"
                  }
                ]
              }
            },
            {
              "name": "errors",
              "type": {
                "type": "map",
                "keyType": "string",
                "valueContainsNull": true,
                "valueType": {
                  "type": "struct",
                  "fields": [
                    {
                      "name": "details",
                      "type": {
                        "type": "array",
                        "containsNull": true,
                        "elementType": {
                          "type": "struct",
                          "fields": [
                            {
                              "name": "type",
                              "type": "string"
                            },
                            {
                              "name": "msg",
                              "type": "string"
                            }
                          ]
                        }
                      },
                      "nullable": false
                    },
                    {
                      "name": "original",
                      "type": "string"
                    }
                  ]
                }
              },
              "nullable": false
            }
          ]
        }
      }
    }
  },
  {
    "description": "$.col1.col2='abc' matches '^[a-z]*$'",
    "engines": [
      "pyspark"
    ],
    "given": {
      "data": [
        {
          "col1": {
            "col2": "abc"
          }
        }
      ],
      "schema": {
        "pyspark": {
          "type": "struct",
          "fields": [
            {
              "name": "col1",
              "type": {
                "type": "struct",
                "fields": [
                  {
                    "name": "col2",
                    "type": "string"
                  }
                ]
              }
            }
          ]
        }
      }
    },
    "when": {
      "json_schema": {
        "type": "object",
        "properties": {
          "col1": {
            "type": "object",
            "properties": {
              "col2": {
                "type": "string",
                "pattern": "^[a-z]*$"
              }
            }
          }
        }
      }
    },
    "then": {
      "data": [
        {
          "col1": {
            "col2": "abc"
          },
          "errors": {}
        }
      ],
      "schema": {
        "pyspark": {
          "type": "struct",
          "fields": [
            {
              "name": "col1",
              "type": {
                "type": "struct",
                "fields": [
                  {
                    "name": "col2",
                    "type": "string"
                  }
                ]
              }
            },
            {
              "name": "errors",
              "type": {
                "type": "map",
                "keyType": "string",
                "valueContainsNull": true,
                "valueType": {
                  "type": "struct",
                  "fields": [
                    {
                      "name": "details",
                      "type": {
                        "type": "array",
                        "containsNull": true,
                        "elementType": {
                          "type": "struct",
                          "fields": [
                            {
                              "name": "type",
                              "type": "string"
                            },
                            {
                              "name": "msg",
                              "type": "string"
                            }
                          ]
                        }
                      },
                      "nullable": false
                    },
                    {
                      "name": "original",
                      "type": "string"
                    }
                  ]
                }
              },
              "nullable": false
            }
          ]
        }
      }
    }
  },
  {
    "description": "$.col1.col2='abc1' matches '^[a-z]*$', error is raised",
    "engines": [
      "pyspark"
    ],
    "given": {
      "data": [
        {
          "col1": {
            "col2": "abc1"
          }
        }
      ],
      "schema": {
        "pyspark": {
          "type": "struct",
          "fields": [
            {
              "name": "col1",
              "type": {
                "type": "struct",
                "fields": [
                  {
                    "name": "col2",
                    "type": "string"
                  }
                ]
              }
            }
          ]
        }
      }
    },
    "when": {
      "json_schema": {
        "type": "object",
        "properties": {
          "col1": {
            "type": "object",
            "properties": {
              "col2": {
                "type": "string",
                "pattern": "^[a-z]*$"
              }
            }
          }
        }
      }
    },
    "then": {
      "data": [
        {
          "col1": {
            "col2": null
          },
          "errors": {
            "col1.col2": {
              "details": [
                {
                  "type": "string_pattern_mismatch",
                  "msg": "String should match pattern \"^[a-z]*$\""
                }
              ],
              "original": "\"abc1\""
            }
          }
        }
      ],
      "schema": {
        "pyspark": {
          "type": "struct",
          "fields": [
            {
              "name": "col1",
              "type": {
                "type": "struct",
                "fields": [
                  {
                    "name": "col2",
                    "type": "string"
                  }
                ]
              }
            },
            {
              "name": "errors",
              "type": {
                "type": "map",
                "keyType": "string",
                "valueContainsNull": true,
                "valueType": {
                  "type": "struct",
                  "fields": [
                    {
                      "name": "details",
                      "type": {
                        "type": "array",
                        "containsNull": true,
                        "elementType": {
                          "type": "struct",
                          "fields": [
                            {
                              "name": "type",
                              "type": "string"
                            },
                            {
                              "name": "msg",
                              "type": "string"
                            }
                          ]
                        }
                      },
                      "nullable": false
                    },
                    {
                      "name": "original",
                      "type": "string"
                    }
                  ]
                }
              },
              "nullable": false
            }
          ]
        }
      }
    }
  },
  {
    "description": "each($.col1.col2.col3['ab', 'a']) matches '^[a-z]*$'",
    "engines": [
      "pyspark"
    ],
    "given": {
      "data": [
        {
          "col1": {
            "col2": {
              "col3": [
                "ab",
                "a"
              ]
            }
          }
        }
      ],
      "schema": {
        "pyspark": {
          "type": "struct",
          "fields": [
            {
              "name": "col1",
              "type": {
                "type": "struct",
                "fields": [
                  {
                    "name": "col2",
                    "type": {
                      "type": "struct",
                      "fields": [
                        {
                          "name": "col3",
                          "type": {
                            "type": "array",
                            "containsNull": true,
                            "elementType": "string"
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        }
      }
    },
    "when": {
      "json_schema": {
        "type": "object",
        "properties": {
          "col1": {
            "type": "object",
            "properties": {
              "col2": {
                "type": "object",
                "properties": {
                  "col3": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "pattern": "^[a-z]*$"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "then": {
      "data": [
        {
          "col1": {
            "col2": {
              "col3": [
                "ab",
                "a"
              ]
            }
          },
          "errors": {}
        }
      ],
      "schema": {
        "pyspark": {
          "type": "struct",
          "fields": [
            {
              "name": "col1",
              "type": {
                "type": "struct",
                "fields": [
                  {
                    "name": "col2",
                    "type": {
                      "type": "struct",
                      "fields": [
                        {
                          "name": "col3",
                          "type": {
                            "type": "array",
                            "containsNull": true,
                            "elementType": "string"
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            },
            {
              "name": "errors",
              "type": {
                "type": "map",
                "keyType": "string",
                "valueContainsNull": true,
                "valueType": {
                  "type": "struct",
                  "fields": [
                    {
                      "name": "details",
                      "type": {
                        "type": "array",
                        "containsNull": true,
                        "elementType": {
                          "type": "struct",
                          "fields": [
                            {
                              "name": "type",
                              "type": "string"
                            },
                            {
                              "name": "msg",
                              "type": "string"
                            },
                            {
                              "name": "loc",
                              "type": {
                                "type": "array",
                                "containsNull": true,
                                "elementType": "integer"
                              }
                            }
                          ]
                        }
                      },
                      "nullable": false
                    },
                    {
                      "name": "original",
                      "type": "string"
                    }
                  ]
                }
              },
              "nullable": false
            }
          ]
        }
      }
    }
  },
  {
    "description": "each($.col1.col2.col3['ab', '123', 'a', 'Ab']) matches '^[a-z]*$', error is raised",
    "engines": [
      "pyspark"
    ],
    "given": {
      "data": [
        {
          "col1": {
            "col2": {
              "col3": [
                "ab",
                "123",
                "a",
                "Ab"
              ]
            }
          }
        }
      ],
      "schema": {
        "pyspark": {
          "type": "struct",
          "fields": [
            {
              "name": "col1",
              "type": {
                "type": "struct",
                "fields": [
                  {
                    "name": "col2",
                    "type": {
                      "type": "struct",
                      "fields": [
                        {
                          "name": "col3",
                          "type": {
                            "type": "array",
                            "containsNull": true,
                            "elementType": "string"
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        }
      }
    },
    "when": {
      "json_schema": {
        "type": "object",
        "properties": {
          "col1": {
            "type": "object",
            "properties": {
              "col2": {
                "type": "object",
                "properties": {
                  "col3": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "pattern": "^[a-z]*$"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "then": {
      "data": [
        {
          "col1": {
            "col2": {
              "col3": [
                "ab",
                null,
                "a",
                null
              ]
            }
          },
          "errors": {
            "col1.col2.col3[]": {
              "details": [
                {
                  "loc": [
                    1,
                    3
                  ],
                  "msg": "String should match pattern \"^[a-z]*$\"",
                  "type": "string_pattern_mismatch"
                }
              ],
              "original": "[\"ab\",\"123\",\"a\",\"Ab\"]"
            }
          }
        }
      ],
      "schema": {
        "pyspark": {
          "type": "struct",
          "fields": [
            {
              "name": "col1",
              "type": {
                "type": "struct",
                "fields": [
                  {
                    "name": "col2",
                    "type": {
                      "type": "struct",
                      "fields": [
                        {
                          "name": "col3",
                          "type": {
                            "type": "array",
                            "containsNull": true,
                            "elementType": "string"
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            },
            {
              "name": "errors",
              "type": {
                "type": "map",
                "keyType": "string",
                "valueContainsNull": true,
                "valueType": {
                  "type": "struct",
                  "fields": [
                    {
                      "name": "details",
                      "type": {
                        "type": "array",
                        "containsNull": true,
                        "elementType": {
                          "type": "struct",
                          "fields": [
                            {
                              "name": "type",
                              "type": "string"
                            },
                            {
                              "name": "msg",
                              "type": "string"
                            },
                            {
                              "name": "loc",
                              "type": {
                                "type": "array",
                                "containsNull": true,
                                "elementType": "integer"
                              }
                            }
                          ]
                        }
                      },
                      "nullable": false
                    },
                    {
                      "name": "original",
                      "type": "string"
                    }
                  ]
                }
              },
              "nullable": false
            }
          ]
        }
      }
    }
  },
  {
    "description": "each($.col1.col2.col3[.col4.col5.col6='ab', ='a']) matches '^[a-z]*$'",
    "engines": [
      "pyspark"
    ],
    "given": {
      "data": [
        {
          "col1": {
            "col2": {
              "col3": [
                {
                  "col4": {
                    "col5": {
                      "col6": "ab"
                    }
                  }
                },
                {
                  "col4": {
                    "col5": {
                      "col6": "a"
                    }
                  }
                }
              ]
            }
          }
        }
      ],
      "schema": {
        "pyspark": {
          "type": "struct",
          "fields": [
            {
              "name": "col1",
              "type": {
                "type": "struct",
                "fields": [
                  {
                    "name": "col2",
                    "type": {
                      "type": "struct",
                      "fields": [
                        {
                          "name": "col3",
                          "type": {
                            "type": "array",
                            "containsNull": true,
                            "elementType": {
                              "type": "struct",
                              "fields": [
                                {
                                  "name": "col4",
                                  "type": {
                                    "type": "struct",
                                    "fields": [
                                      {
                                        "name": "col5",
                                        "type": {
                                          "type": "struct",
                                          "fields": [
                                            {
                                              "name": "col6",
                                              "type": "string"
                                            }
                                          ]
                                        }
                                      }
                                    ]
                                  }
                                }
                              ]
                            }
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        }
      }
    },
    "when": {
      "json_schema": {
        "type": "object",
        "properties": {
          "col1": {
            "type": "object",
            "properties": {
              "col2": {
                "type": "object",
                "properties": {
                  "col3": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "col4": {
                          "type": "object",
                          "properties": {
                            "col5": {
                              "type": "object",
                              "properties": {
                                "col6": {
                                  "type": "string",
                                  "pattern": "^[a-z]*$"
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "then": {
      "data": [
        {
          "col1": {
            "col2": {
              "col3": [
                {
                  "col4": {
                    "col5": {
                      "col6": "ab"
                    }
                  }
                },
                {
                  "col4": {
                    "col5": {
                      "col6": "a"
                    }
                  }
                }
              ]
            }
          },
          "errors": {}
        }
      ],
      "schema": {
        "pyspark": {
          "type": "struct",
          "fields": [
            {
              "name": "col1",
              "type": {
                "type": "struct",
                "fields": [
                  {
                    "name": "col2",
                    "type": {
                      "type": "struct",
                      "fields": [
                        {
                          "name": "col3",
                          "type": {
                            "type": "array",
                            "containsNull": true,
                            "elementType": {
                              "type": "struct",
                              "fields": [
                                {
                                  "name": "col4",
                                  "type": {
                                    "type": "struct",
                                    "fields": [
                                      {
                                        "name": "col5",
                                        "type": {
                                          "type": "struct",
                                          "fields": [
                                            {
                                              "name": "col6",
                                              "type": "string"
                                            }
                                          ]
                                        }
                                      }
                                    ]
                                  }
                                }
                              ]
                            }
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            },
            {
              "name": "errors",
              "type": {
                "type": "map",
                "keyType": "string",
                "valueContainsNull": true,
                "valueType": {
                  "type": "struct",
                  "fields": [
                    {
                      "name": "details",
                      "type": {
                        "type": "array",
                        "containsNull": true,
                        "elementType": {
                          "type": "struct",
                          "fields": [
                            {
                              "name": "type",
                              "type": "string"
                            },
                            {
                              "name": "msg",
                              "type": "string"
                            },
                            {
                              "name": "loc",
                              "type": {
                                "type": "array",
                                "containsNull": true,
                                "elementType": "integer"
                              }
                            }
                          ]
                        }
                      },
                      "nullable": false
                    },
                    {
                      "name": "original",
                      "type": "string"
                    }
                  ]
                }
              },
              "nullable": false
            }
          ]
        }
      }
    }
  },
  {
    "description": "each($.col1.col2.col3[.col4.col5.col6='ab', ='123', ='a', ='Ab']) matches '^[a-z]*$', error is raised",
    "engines": [
      "pyspark"
    ],
    "given": {
      "data": [
        {
          "col1": {
            "col2": {
              "col3": [
                {
                  "col4": {
                    "col5": {
                      "col6": "ab"
                    }
                  }
                },
                {
                  "col4": {
                    "col5": {
                      "col6": "123"
                    }
                  }
                },
                {
                  "col4": {
                    "col5": {
                      "col6": "a"
                    }
                  }
                },
                {
                  "col4": {
                    "col5": {
                      "col6": "Ab"
                    }
                  }
                }
              ]
            }
          }
        }
      ],
      "schema": {
        "pyspark": {
          "type": "struct",
          "fields": [
            {
              "name": "col1",
              "type": {
                "type": "struct",
                "fields": [
                  {
                    "name": "col2",
                    "type": {
                      "type": "struct",
                      "fields": [
                        {
                          "name": "col3",
                          "type": {
                            "type": "array",
                            "containsNull": true,
                            "elementType": {
                              "type": "struct",
                              "fields": [
                                {
                                  "name": "col4",
                                  "type": {
                                    "type": "struct",
                                    "fields": [
                                      {
                                        "name": "col5",
                                        "type": {
                                          "type": "struct",
                                          "fields": [
                                            {
                                              "name": "col6",
                                              "type": "string"
                                            }
                                          ]
                                        }
                                      }
                                    ]
                                  }
                                }
                              ]
                            }
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        }
      }
    },
    "when": {
      "json_schema": {
        "type": "object",
        "properties": {
          "col1": {
            "type": "object",
            "properties": {
              "col2": {
                "type": "object",
                "properties": {
                  "col3": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "col4": {
                          "type": "object",
                          "properties": {
                            "col5": {
                              "type": "object",
                              "properties": {
                                "col6": {
                                  "type": "string",
                                  "pattern": "^[a-z]*$"
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "then": {
      "data": [
        {
          "col1": {
            "col2": {
              "col3": [
                {
                  "col4": {
                    "col5": {
                      "col6": "ab"
                    }
                  }
                },
                {
                  "col4": {
                    "col5": {
                      "col6": null
                    }
                  }
                },
                {
                  "col4": {
                    "col5": {
                      "col6": "a"
                    }
                  }
                },
                {
                  "col4": {
                    "col5": {
                      "col6": null
                    }
                  }
                }
              ]
            }
          },
          "errors": {
            "col1.col2.col3[].col4.col5.col6": {
              "details": [
                {
                  "loc": [
                    1,
                    3
                  ],
                  "msg": "String should match pattern \"^[a-z]*$\"",
                  "type": "string_pattern_mismatch"
                }
              ],
              "original": "[\"ab\",\"123\",\"a\",\"Ab\"]"
            }
          }
        }
      ],
      "schema": {
        "pyspark": {
          "type": "struct",
          "fields": [
            {
              "name": "col1",
              "type": {
                "type": "struct",
                "fields": [
                  {
                    "name": "col2",
                    "type": {
                      "type": "struct",
                      "fields": [
                        {
                          "name": "col3",
                          "type": {
                            "type": "array",
                            "containsNull": true,
                            "elementType": {
                              "type": "struct",
                              "fields": [
                                {
                                  "name": "col4",
                                  "type": {
                                    "type": "struct",
                                    "fields": [
                                      {
                                        "name": "col5",
                                        "type": {
                                          "type": "struct",
                                          "fields": [
                                            {
                                              "name": "col6",
                                              "type": "string"
                                            }
                                          ]
                                        }
                                      }
                                    ]
                                  }
                                }
                              ]
                            }
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            },
            {
              "name": "errors",
              "type": {
                "type": "map",
                "keyType": "string",
                "valueContainsNull": true,
                "valueType": {
                  "type": "struct",
                  "fields": [
                    {
                      "name": "details",
                      "type": {
                        "type": "array",
                        "containsNull": true,
                        "elementType": {
                          "type": "struct",
                          "fields": [
                            {
                              "name": "type",
                              "type": "string"
                            },
                            {
                              "name": "msg",
                              "type": "string"
                            },
                            {
                              "name": "loc",
                              "type": {
                                "type": "array",
                                "containsNull": true,
                                "elementType": "integer"
                              }
                            }
                          ]
                        }
                      },
                      "nullable": false
                    },
                    {
                      "name": "original",
                      "type": "string"
                    }
                  ]
                }
              },
              "nullable": false
            }
          ]
        }
      }
    }
  },
  {
    "description": "each($.col1.col2.col3[123, 456]) matches '^[a-z]*$', exception is raised",
    "engines": [
      "pyspark"
    ],
    "given": {
      "data": [
        {
          "col1": {
            "col2": {
              "col3": [
                123,
                456
              ]
            }
          }
        }
      ],
      "schema": {
        "pyspark": {
          "type": "struct",
          "fields": [
            {
              "name": "col1",
              "type": {
                "type": "struct",
                "fields": [
                  {
                    "name": "col2",
                    "type": {
                      "type": "struct",
                      "fields": [
                        {
                          "name": "col3",
                          "type": {
                            "type": "array",
                            "containsNull": true,
                            "elementType": "integer"
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        }
      }
    },
    "when": {
      "json_schema": {
        "type": "object",
        "properties": {
          "col1": {
            "type": "object",
            "properties": {
              "col2": {
                "type": "object",
                "properties": {
                  "col3": {
                    "type": "array",
                    "items": {
                      "type": "integer",
                      "pattern": "^[a-z]*$"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "then": {
      "raises": {
        "type": "ValueError",
        "match": "pattern rule can only be applied to string columns"
      }
    }
  }
]
